name: Build Candle Portable (Windows) with Chinese Support

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: 'Branch to build'
        required: true
        default: 'master'
        type: string

env:
  BUILD_TYPE: Release
  VCPKG_DEFAULT_BINARY_CACHE: ${{ github.workspace }}/vcpkg_cache

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout Candle
        uses: actions/checkout@v4
        with:
          repository: Denvi/Candle
          ref: ${{ github.event.inputs.branch_name }}
          fetch-depth: 0
          fetch-tags: true

      # 创建 translations 目录并写入完整的 candle_zh_CN.ts
      - name: Add Chinese translation file
        shell: pwsh
        run: |
          $tsDir = "src/candle/translations"
          $tsFile = "$tsDir/candle_zh_CN.ts"
          if (!(Test-Path $tsDir)) {
            New-Item -ItemType Directory -Path $tsDir
          }

          $content = @'
          <?xml version="1.0" encoding="utf-8"?>
          <!DOCTYPE TS>
          <TS version="2.1" language="zh_CN">
          <context>
              <name>GCodeTableModel</name>
              <message>
                  <source>#</source>
                  <translation>#</translation>
              </message>
              <message>
                  <source>Command</source>
                  <translation>命令</translation>
              </message>
              <message>
                  <source>State</source>
                  <translation>状态</translation>
              </message>
              <message>
                  <source>Response</source>
                  <translation>响应</translation>
              </message>
              <message>
                  <source>Line</source>
                  <translation>行号</translation>
              </message>
              <message>
                  <source>Args</source>
                  <translation>参数</translation>
              </message>
              <message>
                  <source>In queue</source>
                  <translation>队列中</translation>
              </message>
              <message>
                  <source>Sent</source>
                  <translation>已发送</translation>
              </message>
              <message>
                  <source>Processed</source>
                  <translation>已处理</translation>
              </message>
              <message>
                  <source>Skipped</source>
                  <translation>已跳过</translation>
              </message>
              <message>
                  <source>Unknown</source>
                  <translation>未知</translation>
              </message>
          </context>
          <context>
              <name>Overlay</name>
              <message>
                  <source>Vertices: %1</source>
                  <translation>顶点数：%1</translation>
              </message>
              <message>
                  <source>Updating</source>
                  <translation>更新中</translation>
              </message>
          </context>
          <context>
              <name>TableHistoryManager</name>
              <message>
                  <source>❐</source>
                  <translation>❐</translation>
              </message>
              <message>
                  <source>✍</source>
                  <translation>✍</translation>
              </message>
              <message>
                  <source>+</source>
                  <translation>+</translation>
              </message>
              <message>
                  <source>−</source>
                  <translation>−</translation>
              </message>
          </context>
          <context>
              <name>frmAbout</name>
              <message>
                  <source>About</source>
                  <translation>关于</translation>
              </message>
              <message>
                  <source>&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;&lt;span style=&quot; font-weight:600;&quot;&gt;The program is provided AS IS without any guarantees or warranty. Use at your own risk.&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</source>
                  <translation>&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;&lt;span style=&quot; font-weight:600;&quot;&gt;本程序按现状提供，不作任何保证或担保。使用风险自负。&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</translation>
              </message>
              <message>
                  <source>OK</source>
                  <translation>确定</translation>
              </message>
              <message>
                  <source>&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;%1&lt;br/&gt;Version: %2&lt;br/&gt;Build: %3&lt;br/&gt;License: GNU GENERAL PUBLIC LICENSE&lt;br/&gt;Visit: &lt;a href=&quot;https://github.com/Denvi/Candle/&quot  ;&gt;&lt;span style=&quot; text-decoration: underline; color:#0000ff;&quot;&gt;https://github.com/Denvi/Candle/&lt  ;br/&gt;&lt;/span&gt;&lt;/a&gt;© 2015-2025 Hayrullin Denis Ravilevich&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</source>
                  <translation>&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;%1&lt;br/&gt;版本：%2&lt;br/&gt;构建：%3&lt;br/&gt;许可证：GNU 通用公共许可证&lt;br/&gt;访问：&lt;a href=&quot;https://github.com/Denvi/Candle/&quot  ;&gt;&lt;span style=&quot; text-decoration: underline; color:#0000ff;&quot;&gt;https://github.com/Denvi/Candle/&lt  ;br/&gt;&lt;/span&gt;&lt;/a&gt;© 2015-2025 Hayrullin Denis Ravilevich&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</translation>
              </message>
          </context>
          <context>
              <name>frmHelp</name>
              <message>
                  <source>Documentation</source>
                  <translation>文档</translation>
              </message>
              <message>
                  <source>Contents</source>
                  <translation>目录</translation>
              </message>
              <message>
                  <source>Search</source>
                  <translation>搜索</translation>
              </message>
              <message>
                  <source>Next</source>
                  <translation>下一页</translation>
              </message>
              <message>
                  <source>Previous</source>
                  <translation>上一页</translation>
              </message>
              <message>
                  <source>Close</source>
                  <translation>关闭</translation>
              </message>
              <message>
                  <source>Search:</source>
                  <translation>搜索：</translation>
              </message>
          </context>
          <context>
              <name>frmMain</name>
              <message>
                  <source>Check</source>
                  <translation>检查</translation>
              </message>
              <message>
                  <source>Open</source>
                  <translation>打开</translation>
              </message>
              <message>
                  <source>Candle</source>
                  <translation>Candle</translation>
              </message>
              <message>
                  <source>Program</source>
                  <translation>程序</translation>
              </message>
              <message>
                  <source>Scroll</source>
                  <translation>滚动</translation>
              </message>
              <message>
                  <source>Reset</source>
                  <translation>重置</translation>
              </message>
              <message>
                  <source>Send</source>
                  <translation>发送</translation>
              </message>
              <message>
                  <source>Pause</source>
                  <translation>暂停</translation>
              </message>
              <message>
                  <source>Abort</source>
                  <translation>中止</translation>
              </message>
              <message>
                  <source>&amp;File</source>
                  <translation>文件(&amp;F)</translation>
              </message>
              <message>
                  <source>&amp;Recent files</source>
                  <translation>最近文件(&amp;R)</translation>
              </message>
              <message>
                  <source>&amp;Service</source>
                  <translation>服务(&amp;S)</translation>
              </message>
              <message>
                  <source>&amp;Help</source>
                  <translation>帮助(&amp;H)</translation>
              </message>
              <message>
                  <source>&amp;View</source>
                  <translation>视图(&amp;V)</translation>
              </message>
              <message>
                  <source>&amp;Windows</source>
                  <translation>窗口(&amp;W)</translation>
              </message>
              <message>
                  <source>&amp;Panels</source>
                  <translation>面板(&amp;P)</translation>
              </message>
              <message>
                  <source>Modification</source>
                  <translation>修改</translation>
              </message>
              <message>
                  <source>Overriding</source>
                  <translation>倍率调节</translation>
              </message>
              <message>
                  <source>Heightmap</source>
                  <translation>高度图</translation>
              </message>
              <message>
                  <source>Use heightmap</source>
                  <translation>使用高度图</translation>
              </message>
              <message>
                  <source>Absent</source>
                  <translation>无</translation>
              </message>
              <message>
                  <source>Map:</source>
                  <translation>地图：</translation>
              </message>
              <message>
                  <source>Create</source>
                  <translation>创建</translation>
              </message>
              <message>
                  <source>Edit</source>
                  <translation>编辑</translation>
              </message>
              <message>
                  <source>Border:</source>
                  <translation>边界：</translation>
              </message>
              <message>
                  <source>X:</source>
                  <translation>X：</translation>
              </message>
              <message>
                  <source>H:</source>
                  <translation>高度(H)：</translation>
              </message>
              <message>
                  <source>Y:</source>
                  <translation>Y：</translation>
              </message>
              <message>
                  <source>W:</source>
                  <translation>宽度(W)：</translation>
              </message>
              <message>
                  <source>Show border</source>
                  <translation>显示边界</translation>
              </message>
              <message>
                  <source>Auto</source>
                  <translation>自动</translation>
              </message>
              <message>
                  <source>Probe grid:</source>
                  <translation>探测网格：</translation>
              </message>
              <message>
                  <source>Zt:</source>
                  <translation>顶部 Z(Zt)：</translation>
              </message>
              <message>
                  <source>Zb:</source>
                  <translation>底部 Z(Zb)：</translation>
              </message>
              <message>
                  <source>F:</source>
                  <translation>进给(F)：</translation>
              </message>
              <message>
                  <source>Show probe grid</source>
                  <translation>显示探测网格</translation>
              </message>
              <message>
                  <source>Interpolation grid:</source>
                  <translation>插值网格：</translation>
              </message>
              <message>
                  <source>Show interpolation grid</source>
                  <translation>显示插值网格</translation>
              </message>
              <message>
                  <source>Device</source>
                  <translation>设备</translation>
              </message>
              <message>
                  <source>State</source>
                  <translation>状态</translation>
              </message>
              <message>
                  <source>X</source>
                  <translation>X</translation>
              </message>
              <message>
                  <source>Y</source>
                  <translation>Y</translation>
              </message>
              <message>
                  <source>Z</source>
                  <translation>Z</translation>
              </message>
              <message>
                  <source>Status:</source>
                  <translation>状态：</translation>
              </message>
              <message>
                  <source>Control</source>
                  <translation>控制</translation>
              </message>
              <message>
                  <source>Unlock</source>
                  <translation>解锁</translation>
              </message>
              <message>
                  <source>...</source>
                  <translation>…</translation>
              </message>
              <message>
                  <source>Home</source>
                  <translation>回零</translation>
              </message>
              <message>
                  <source>Flood</source>
                  <translation>冷却液</translation>
              </message>
              <message>
                  <source>Spindle</source>
                  <translation>主轴</translation>
              </message>
              <message>
                  <source>Spindle on/off</source>
                  <translation>主轴启/停</translation>
              </message>
              <message>
                  <source>Jog</source>
                  <translation>点动</translation>
              </message>
              <message>
                  <source>X+</source>
                  <translation>X+</translation>
              </message>
              <message>
                  <source>X-</source>
                  <translation>X-</translation>
              </message>
              <message>
                  <source>Y-</source>
                  <translation>Y-</translation>
              </message>
              <message>
                  <source>Stop</source>
                  <translation>停止</translation>
              </message>
              <message>
                  <source>Y+</source>
                  <translation>Y+</translation>
              </message>
              <message>
                  <source>Z+</source>
                  <translation>Z+</translation>
              </message>
              <message>
                  <source>Z-</source>
                  <translation>Z-</translation>
              </message>
              <message>
                  <source>Continuously</source>
                  <translation>连续</translation>
              </message>
              <message>
                  <source>0.01</source>
                  <translation>0.01</translation>
              </message>
              <message>
                  <source>0.1</source>
                  <translation>0.1</translation>
              </message>
              <message>
                  <source>1</source>
                  <translation>1</translation>
              </message>
              <message>
                  <source>5</source>
                  <translation>5</translation>
              </message>
              <message>
                  <source>10</source>
                  <translation>10</translation>
              </message>
              <message>
                  <source>100</source>
                  <translation>100</translation>
              </message>
              <message>
                  <source>Step:</source>
                  <translation>步长：</translation>
              </message>
              <message>
                  <source>Feed:</source>
                  <translation>进给：</translation>
              </message>
              <message>
                  <source>50</source>
                  <translation>50</translation>
              </message>
              <message>
                  <source>500</source>
                  <translation>500</translation>
              </message>
              <message>
                  <source>1000</source>
                  <translation>1000</translation>
              </message>
              <message>
                  <source>2000</source>
                  <translation>2000</translation>
              </message>
              <message>
                  <source>Keyboard control</source>
                  <translation>键盘控制</translation>
              </message>
              <message>
                  <source>Visualizer</source>
                  <translation>可视化器</translation>
              </message>
              <message>
                  <source>Fit</source>
                  <translation>适应</translation>
              </message>
              <message>
                  <source>Top view</source>
                  <translation>顶视图</translation>
              </message>
              <message>
                  <source>Isometric view</source>
                  <translation>等轴测视图</translation>
              </message>
              <message>
                  <source>Front view</source>
                  <translation>前视图</translation>
              </message>
              <message>
                  <source>Left view</source>
                  <translation>左视图</translation>
              </message>
              <message>
                  <source>Console</source>
                  <translation>控制台</translation>
              </message>
              <message>
                  <source>Send command</source>
                  <translation>发送命令</translation>
              </message>
              <message>
                  <source>Clear console</source>
                  <translation>清空控制台</translation>
              </message>
              <message>
                  <source>_spacerTop</source>
                  <translation>顶部间隔</translation>
              </message>
              <message>
                  <source>_spacerLeft</source>
                  <translation>左侧间隔</translation>
              </message>
              <message>
                  <source>_spacerRight</source>
                  <translation>右侧间隔</translation>
              </message>
              <message>
                  <source>User</source>
                  <translation>用户</translation>
              </message>
              <message>
                  <source>&amp;New</source>
                  <translation>新建(&amp;N)</translation>
              </message>
              <message>
                  <source>&amp;Open</source>
                  <translation>打开(&amp;O)</translation>
              </message>
              <message>
                  <source>&amp;Save</source>
                  <translation>保存(&amp;S)</translation>
              </message>
              <message>
                  <source>Save &amp;as...</source>
                  <translation>另存为(&amp;A)...</translation>
              </message>
              <message>
                  <source>Save &amp;transformed as...</source>
                  <translation>保存变换后为(&amp;T)...</translation>
              </message>
              <message>
                  <source>&amp;Clear</source>
                  <translation>清空(&amp;C)</translation>
              </message>
              <message>
                  <source>E&amp;xit</source>
                  <translation>退出(&amp;X)</translation>
              </message>
              <message>
                  <source>&amp;Settings</source>
                  <translation>设置(&amp;S)</translation>
              </message>
              <message>
                  <source>&amp;About</source>
                  <translation>关于(&amp;A)</translation>
              </message>
              <message>
                  <source>Spindle speed +</source>
                  <translation>主轴转速 +</translation>
              </message>
              <message>
                  <source>Spindle speed -</source>
                  <translation>主轴转速 -</translation>
              </message>
              <message>
                  <source>Jog step next</source>
                  <translation>下一个点动步长</translation>
              </message>
              <message>
                  <source>Jog step previous</source>
                  <translation>上一个点动步长</translation>
              </message>
              <message>
                  <source>Jog feed next</source>
                  <translation>下一个点动进给</translation>
              </message>
              <message>
                  <source>Jog feed previous</source>
                  <translation>上一个点动进给</translation>
              </message>
              <message>
                  <source>Feed override +</source>
                  <translation>进给倍率 +</translation>
              </message>
              <message>
                  <source>Feed override -</source>
                  <translation>进给倍率 -</translation>
              </message>
              <message>
                  <source>Rapid override +</source>
                  <translation>快速移动倍率 +</translation>
              </message>
              <message>
                  <source>Rapid override -</source>
                  <translation>快速移动倍率 -</translation>
              </message>
              <message>
                  <source>Spindle override +</source>
                  <translation>主轴倍率 +</translation>
              </message>
              <message>
                  <source>Spindle override -</source>
                  <translation>主轴倍率 -</translation>
              </message>
              <message>
                  <source>Feed override</source>
                  <translation>进给倍率</translation>
              </message>
              <message>
                  <source>Rapid speed override</source>
                  <translation>快速移动倍率</translation>
              </message>
              <message>
                  <source>Spindle speed override</source>
                  <translation>主轴倍率</translation>
              </message>
              <message>
                  <source>&amp;Lock windows</source>
                  <translation>锁定窗口(&amp;L)</translation>
              </message>
              <message>
                  <source>L&amp;ock panels</source>
                  <translation>锁定面板(&amp;O)</translation>
              </message>
              <message>
                  <source>&amp;Documentation</source>
                  <translation>文档(&amp;D)</translation>
              </message>
              <message>
                  <source>Unknown</source>
                  <translation>未知</translation>
              </message>
              <message>
                  <source>Idle</source>
                  <translation>空闲</translation>
              </message>
              <message>
                  <source>Alarm</source>
                  <translation>警报</translation>
              </message>
              <message>
                  <source>Run</source>
                  <translation>运行</translation>
              </message>
              <message>
                  <source>Hold</source>
                  <translation>保持</translation>
              </message>
              <message>
                  <source>Queue</source>
                  <translation>队列</translation>
              </message>
              <message>
                  <source>Door</source>
                  <translation>门开</translation>
              </message>
              <message>
                  <source>Sleep</source>
                  <translation>休眠</translation>
              </message>
              <message>
                  <source>Feed rate:</source>
                  <translation>进给速率：</translation>
              </message>
              <message>
                  <source>Rapid speed:</source>
                  <translation>快速移动速度：</translation>
              </message>
              <message>
                  <source>Spindle speed:</source>
                  <translation>主轴转速：</translation>
              </message>
              <message>
                  <source>&amp;Insert line</source>
                  <translation>插入行(&amp;I)</translation>
              </message>
              <message>
                  <source>&amp;Delete lines</source>
                  <translation>删除行(&amp;D)</translation>
              </message>
              <message>
                  <source>Don&apos;t show again</source>
                  <translation>不再显示</translation>
              </message>
              <message>
                  <source>Speed:</source>
                  <translation>速度：</translation>
              </message>
              <message>
                  <source>G-Code files (*.nc *.ncc *.ngc *.tap *.txt *.gcode)</source>
                  <translation>G代码文件 (*.nc *.ncc *.ngc *.tap *.txt *.gcode)</translation>
              </message>
              <message>
                  <source>G-Code files (*.nc *.ncc *.ngc *.tap *.txt *.gcode);;All files (*.*)</source>
                  <translation>G代码文件 (*.nc *.ncc *.ngc *.tap *.txt *.gcode);;所有文件 (*.*)</translation>
              </message>
              <message>
                  <source>Change tool and press &apos;Pause&apos; button to continue job</source>
                  <translation>更换刀具并按“暂停”按钮以继续作业</translation>
              </message>
              <message>
                  <source>M6 command detected. Send tool change commands?
          </source>
                  <translation>检测到 M6 命令。是否发送换刀命令？</translation>
              </message>
              <message>
                  <source>G-code program file was changed. Save?</source>
                  <translation>G代码程序文件已更改。是否保存？</translation>
              </message>
              <message>
                  <source>Heightmap file was changed. Save?</source>
                  <translation>高度图文件已更改。是否保存？</translation>
              </message>
              <message>
                  <source>Not connected</source>
                  <translation>未连接</translation>
              </message>
              <message>
                  <source>G-code program</source>
                  <translation>G代码程序</translation>
              </message>
              <message>
                  <source>Probe</source>
                  <translation>探测</translation>
              </message>
              <message>
                  <source>Port opened</source>
                  <translation>端口已打开</translation>
              </message>
              <message>
                  <source>Job done.
          Time elapsed: %1</source>
                  <translation>作业完成。
          耗时：%1</translation>
              </message>
              <message>
                  <source>PS: %1</source>
                  <translation>PS: %1</translation>
              </message>
              <message>
                  <source>AS: %1</source>
                  <translation>AS: %1</translation>
              </message>
              <message>
                  <source>F/S: %1 / %2</source>
                  <translation>F/S: %1 / %2</translation>
              </message>
              <message>
                  <source>Error message(s) received:
          </source>
                  <translation>收到错误信息：</translation>
              </message>
              <message>
                  <source>Buffer: %1 / %2 / %3</source>
                  <translation>缓冲：%1 / %2 / %3</translation>
              </message>
              <message>
                  <source>File sending in progress. Terminate and exit?</source>
                  <translation>文件正在发送。终止并退出吗？</translation>
              </message>
              <message>
                  <source>Heightmap files (*.map)</source>
                  <translation>高度图文件 (*.map)</translation>
              </message>
              <message>
                  <source>Opening file...</source>
                  <translation>正在打开文件...</translation>
              </message>
              <message>
                  <source>Can&apos;t open file:
          </source>
                  <translation>无法打开文件：</translation>
              </message>
              <message>
                  <source>Following commands will be sent before selected line:
          </source>
                  <translation>以下命令将在选定行之前发送：</translation>
              </message>
              <message>
                  <source> (%1)</source>
                  <translation> (%1)</translation>
              </message>
              <message>
                  <source>Delete lines?</source>
                  <translation>删除行吗？</translation>
              </message>
              <message>
                  <source>Untitled</source>
                  <translation>无标题</translation>
              </message>
              <message>
                  <source>Save file as</source>
                  <translation>文件另存为</translation>
              </message>
              <message>
                  <source> (%1/%2/%3)</source>
                  <translation> (%1/%2/%3)</translation>
              </message>
              <message>
                  <source> (%1/%2)</source>
                  <translation> (%1/%2)</translation>
              </message>
              <message>
                  <source>C</source>
                  <translation>C</translation>
              </message>
              <message>
                  <source>Changing grid settings will reset probe data. Continue?</source>
                  <translation>更改网格设置将重置探测数据。继续吗？</translation>
              </message>
              <message>
                  <source>Applying heightmap...</source>
                  <translation>正在应用高度图...</translation>
              </message>
              <message>
                  <source>Subdividing segments...</source>
                  <translation>正在细分线段...</translation>
              </message>
              <message>
                  <source>Updating Z-coordinates...</source>
                  <translation>正在更新 Z 坐标...</translation>
              </message>
              <message>
                  <source>Modifying G-code program...</source>
                  <translation>正在修改 G代码程序...</translation>
              </message>
              <message>
                  <source>Perspective view</source>
                  <translation>透视视图</translation>
              </message>
              <message>
                  <source>&amp;Logs</source>
                  <translation>日志(&amp;L)</translation>
              </message>
              <message>
                  <source>Script</source>
                  <translation>脚本</translation>
              </message>
              <message>
                  <source>Log</source>
                  <translation>日志</translation>
              </message>
              <message>
                  <source>&amp;Reload</source>
                  <translation>重新加载(&amp;R)</translation>
              </message>
              <message>
                  <source>Move toolhead to heightmap origin</source>
                  <translation>移动刀头到高度图原点</translation>
              </message>
              <message>
                  <source>Origin</source>
                  <translation>原点</translation>
              </message>
              <message>
                  <source>Origin:</source>
                  <translation>原点：</translation>
              </message>
              <message>
                  <source>Type:</source>
                  <translation>类型：</translation>
              </message>
              <message>
                  <source>Bicubic</source>
                  <translation>双三次</translation>
              </message>
              <message>
                  <source>Show origin</source>
                  <translation>显示原点</translation>
              </message>
              <message>
                  <source>Use current toolhead position</source>
                  <translation>使用当前刀头位置</translation>
              </message>
              <message>
                  <source>Tool</source>
                  <translation>刀具</translation>
              </message>
              <message>
                  <source>&amp;Delete</source>
                  <translation>删除(&amp;D)</translation>
              </message>
              <message>
                  <source>Default</source>
                  <translation>默认</translation>
              </message>
              <message>
                  <source>&amp;Profiles</source>
                  <translation>配置文件(&amp;P)</translation>
              </message>
              <message>
                  <source>Enter profile name</source>
                  <translation>输入配置文件名</translation>
              </message>
              <message>
                  <source>&amp;Create</source>
                  <translation>创建(&amp;C)</translation>
              </message>
              <message>
                  <source>Profile &apos;%1&apos; already exists</source>
                  <translation>配置文件“%1”已存在</translation>
              </message>
              <message>
                  <source>Machine</source>
                  <translation>机床</translation>
              </message>
              <message>
                  <source>Work</source>
                  <translation>工件</translation>
              </message>
              <message>
                  <source>A</source>
                  <translation>A</translation>
              </message>
              <message>
                  <source>A+</source>
                  <translation>A+</translation>
              </message>
              <message>
                  <source>A-</source>
                  <translation>A-</translation>
              </message>
              <message>
                  <source>Connection error </source>
                  <translation>连接错误 </translation>
              </message>
              <message>
                  <source>&amp;Import</source>
                  <translation>导入(&amp;I)</translation>
              </message>
              <message>
                  <source>&amp;Export</source>
                  <translation>导出(&amp;E)</translation>
              </message>
              <message>
                  <source>Save</source>
                  <translation>保存</translation>
              </message>
              <message>
                  <source>Select profiles</source>
                  <translation>选择配置文件</translation>
              </message>
              <message>
                  <source>Profile &apos;%1&apos; already exists. Overwrite?</source>
                  <translation>配置文件“%1”已存在。是否覆盖？</translation>
              </message>
              <message>
                  <source>Profiles (*.cpr)</source>
                  <translation>配置文件 (*.cpr)</translation>
              </message>
              <message>
                  <source>Documentation</source>
                  <translation>文档</translation>
              </message>
              <message>
                  <source>From Line</source>
                  <translation>从行开始</translation>
              </message>
              <message>
                  <source>Sending file from SD card completed</source>
                  <translation>从 SD 卡发送文件完成</translation>
              </message>
              <message>
                  <source>&amp;Copy lines</source>
                  <translation>复制行(&amp;C)</translation>
              </message>
              <message>
                  <source>&amp;Paste lines</source>
                  <translation>粘贴行(&amp;P)</translation>
              </message>
              <message>
                  <source>&amp;Cut lines</source>
                  <translation>剪切行(&amp;T)</translation>
              </message>
              <message>
                  <source>&amp;Undo</source>
                  <translation>撤销(&amp;U)</translation>
              </message>
              <message>
                  <source>&amp;Redo</source>
                  <translation>重做(&amp;R)</translation>
              </message>
              <message>
                  <source>&lt;span style=&quot;color:#ff0000;&quot;&gt;%1&lt;/span&gt;</source>
                  <translation>&lt;span style=&quot;color:#ff0000;&quot;&gt;%1&lt;/span&gt;</translation>
              </message>
              <message>
                  <source>[%1] </source>
                  <translation>[%1] </translation>
              </message>
              <message>
                  <source> [%1]</source>
                  <translation> [%1]</translation>
              </message>
              <message>
                  <source>Updating...</source>
                  <translation>更新中...</translation>
              </message>
          </context>
          <context>
              <name>frmScript</name>
              <message>
                  <source>Open</source>
                  <translation>打开</translation>
              </message>
              <message>
                  <source>Start</source>
                  <translation>开始</translation>
              </message>
              <message>
                  <source>Script files (*.js)</source>
                  <translation>脚本文件 (*.js)</translation>
              </message>
              <message>
                  <source>Can&apos;t open file:
          </source>
                  <translation>无法打开文件：</translation>
              </message>
              <message>
                  <source>New</source>
                  <translation>新建</translation>
              </message>
              <message>
                  <source>Save</source>
                  <translation>保存</translation>
              </message>
              <message>
                  <source>Script was changed. Save?</source>
                  <translation>脚本已更改。是否保存？</translation>
              </message>
              <message>
                  <source>Save file as</source>
                  <translation>文件另存为</translation>
              </message>
              <message>
                  <source>Debug</source>
                  <translation>调试</translation>
              </message>
          </context>
          <context>
              <name>frmSettings</name>
              <message>
                  <source>Reset settings to default values?</source>
                  <translation>将设置重置为默认值吗？</translation>
              </message>
              <message>
                  <source>Settings</source>
                  <translation>设置</translation>
              </message>
              <message>
                  <source>Connection</source>
                  <translation>连接</translation>
              </message>
              <message>
                  <source>Baud:</source>
                  <translation>波特率：</translation>
              </message>
              <message>
                  <source>Port:</source>
                  <translation>端口：</translation>
              </message>
              <message>
                  <source>9600</source>
                  <translation>9600</translation>
              </message>
              <message>
                  <source>14400</source>
                  <translation>14400</translation>
              </message>
              <message>
                  <source>19200</source>
                  <translation>19200</translation>
              </message>
              <message>
                  <source>38400</source>
                  <translation>38400</translation>
              </message>
              <message>
                  <source>57600</source>
                  <translation>57600</translation>
              </message>
              <message>
                  <source>115200</source>
                  <translation>115200</translation>
              </message>
              <message>
                  <source>...</source>
                  <translation>…</translation>
              </message>
              <message>
                  <source>Status query period:</source>
                  <translation>状态查询周期：</translation>
              </message>
              <message>
                  <source>max.:</source>
                  <translation>最大：</translation>
              </message>
              <message>
                  <source>Laser power min.:</source>
                  <translation>激光功率最小值：</translation>
              </message>
              <message>
                  <source>Spindle speed min.:</source>
                  <translation>主轴转速最小值：</translation>
              </message>
              <message>
                  <source>Reference position:</source>
                  <translation>参考位置：</translation>
              </message>
              <message>
                  <source>X-</source>
                  <translation>X-</translation>
              </message>
              <message>
                  <source>X+</source>
                  <translation>X+</translation>
              </message>
              <message>
                  <source>Y-</source>
                  <translation>Y-</translation>
              </message>
              <message>
                  <source>Y+</source>
                  <translation>Y+</translation>
              </message>
              <message>
                  <source>Z-</source>
                  <translation>Z-</translation>
              </message>
              <message>
                  <source>Z+</source>
                  <translation>Z+</translation>
              </message>
              <message>
                  <source>Sender</source>
                  <translation>发送器</translation>
              </message>
              <message>
                  <source>Use program start commands:</source>
                  <translation>使用程序启动命令：</translation>
              </message>
              <message>
                  <source>Use program end commands:</source>
                  <translation>使用程序结束命令：</translation>
              </message>
              <message>
                  <source>Use tool change commands:</source>
                  <translation>使用换刀命令：</translation>
              </message>
              <message>
                  <source>Confirm tool change commands execution</source>
                  <translation>确认换刀命令执行</translation>
              </message>
              <message>
                  <source>Pause sender on M6 command</source>
                  <translation>在 M6 命令时暂停发送器</translation>
              </message>
              <message>
                  <source>Ignore error responses</source>
                  <translation>忽略错误响应</translation>
              </message>
              <message>
                  <source>Automatically set parser state before sending from selected line</source>
                  <translation>从选定行发送前自动设置解析器状态</translation>
              </message>
              <message>
                  <source>Visualizer</source>
                  <translation>可视化器</translation>
              </message>
              <message>
                  <source>Z-buffer</source>
                  <translation>Z-缓冲区</translation>
              </message>
              <message>
                  <source>MSAA</source>
                  <translation>多重采样抗锯齿</translation>
              </message>
              <message>
                  <source>Line width:</source>
                  <translation>线宽：</translation>
              </message>
              <message>
                  <source>FPS lock:</source>
                  <translation>帧率锁定：</translation>
              </message>
              <message>
                  <source>30</source>
                  <translation>30</translation>
              </message>
              <message>
                  <source>60</source>
                  <translation>60</translation>
              </message>
              <message>
                  <source>120</source>
                  <translation>120</translation>
              </message>
              <message>
                  <source>Program draw mode:</source>
                  <translation>程序绘制模式：</translation>
              </message>
              <message>
                  <source>Vectors</source>
                  <translation>矢量</translation>
              </message>
              <message>
                  <source>Raster</source>
                  <translation>光栅</translation>
              </message>
              <message>
                  <source>By &apos;Z&apos;-code</source>
                  <translation>按 Z 值</translation>
              </message>
              <message>
                  <source>By &apos;S&apos;-code</source>
                  <translation>按 S 值</translation>
              </message>
              <message>
                  <source>Grayscale segments</source>
                  <translation>灰度段</translation>
              </message>
              <message>
                  <source>Simplify geometry</source>
                  <translation>简化几何体</translation>
              </message>
              <message>
                  <source>Precision:</source>
                  <translation>精度：</translation>
              </message>
              <message>
                  <source>V-sync</source>
                  <translation>垂直同步</translation>
              </message>
              <message>
                  <source>Smoothing</source>
                  <translation>平滑</translation>
              </message>
              <message>
                  <source>Colors</source>
                  <translation>颜色</translation>
              </message>
              <message>
                  <source>Z-movement:</source>
                  <translation>Z轴移动：</translation>
              </message>
              <message>
                  <source>Toolpath</source>
                  <translation>刀具路径</translation>
              </message>
              <message>
                  <source>Background:</source>
                  <translation>背景：</translation>
              </message>
              <message>
                  <source>Highlight:</source>
                  <translation>高亮：</translation>
              </message>
              <message>
                  <source>Start point:</source>
                  <translation>起点：</translation>
              </message>
              <message>
                  <source>End point:</source>
                  <translation>终点：</translation>
              </message>
              <message>
                  <source>Text:</source>
                  <translation>文本：</translation>
              </message>
              <message>
                  <source>Tool:</source>
                  <translation>刀具：</translation>
              </message>
              <message>
                  <source>Drawn:</source>
                  <translation>已绘制：</translation>
              </message>
              <message>
                  <source>Normal:</source>
                  <translation>正常：</translation>
              </message>
              <message>
                  <source>Tool model</source>
                  <translation>刀具模型</translation>
              </message>
              <message>
                  <source>Type:</source>
                  <translation>类型：</translation>
              </message>
              <message>
                  <source>Diameter:</source>
                  <translation>直径：</translation>
              </message>
              <message>
                  <source>Flat</source>
                  <translation>平底</translation>
              </message>
              <message>
                  <source>Conic</source>
                  <translation>锥形</translation>
              </message>
              <message>
                  <source>Angle:</source>
                  <translation>角度：</translation>
              </message>
              <message>
                  <source>Length:</source>
                  <translation>长度：</translation>
              </message>
              <message>
                  <source>Shortcuts</source>
                  <translation>快捷键</translation>
              </message>
              <message>
                  <source>Command</source>
                  <translation>命令</translation>
              </message>
              <message>
                  <source>Text</source>
                  <translation>文本</translation>
              </message>
              <message>
                  <source>Console</source>
                  <translation>控制台</translation>
              </message>
              <message>
                  <source>Show G-code program commands</source>
                  <translation>显示 G代码程序命令</translation>
              </message>
              <message>
                  <source>Show UI commands</source>
                  <translation>显示 UI 命令</translation>
              </message>
              <message>
                  <source>Command auto-completion</source>
                  <translation>命令自动补全</translation>
              </message>
              <message>
                  <source>User interface</source>
                  <translation>用户界面</translation>
              </message>
              <message>
                  <source>pt</source>
                  <translation>磅</translation>
              </message>
              <message>
                  <source>8</source>
                  <translation>8</translation>
              </message>
              <message>
                  <source>9</source>
                  <translation>9</translation>
              </message>
              <message>
                  <source>10</source>
                  <translation>10</translation>
              </message>
              <message>
                  <source>11</source>
                  <translation>11</translation>
              </message>
              <message>
                  <source>12</source>
                  <translation>12</translation>
              </message>
              <message>
                  <source>Font size:</source>
                  <translation>字体大小：</translation>
              </message>
              <message>
                  <source>Language:</source>
                  <translation>语言：</translation>
              </message>
              <message>
                  <source>(restart needed)</source>
                  <translation>（需要重启）</translation>
              </message>
              <message>
                  <source>Set to defaults</source>
                  <translation>恢复默认</translation>
              </message>
              <message>
                  <source>OK</source>
                  <translation>确定</translation>
              </message>
              <message>
                  <source>Cancel</source>
                  <translation>取消</translation>
              </message>
              <message>
                  <source>Invert slider controls</source>
                  <translation>反转滑块控制</translation>
              </message>
              <message>
                  <source>250000</source>
                  <translation>250000</translation>
              </message>
              <message>
                  <source>Panel width:</source>
                  <translation>面板宽度：</translation>
              </message>
              <message>
                  <source>(average char width)</source>
                  <translation>（平均字符宽度）</translation>
              </message>
              <message>
                  <source>X</source>
                  <translation>X</translation>
              </message>
              <message>
                  <source>Y</source>
                  <translation>Y</translation>
              </message>
              <message>
                  <source>Enable axis &apos;A&apos;</source>
                  <translation>启用 A 轴</translation>
              </message>
              <message>
                  <source>direction:</source>
                  <translation>方向：</translation>
              </message>
              <message>
                  <source>Import</source>
                  <translation>导入</translation>
              </message>
              <message>
                  <source>Export</source>
                  <translation>导出</translation>
              </message>
              <message>
                  <source>Save</source>
                  <translation>保存</translation>
              </message>
              <message>
                  <source>Open</source>
                  <translation>打开</translation>
              </message>
              <message>
                  <source>Shortcut files (*.sc)</source>
                  <translation>快捷键文件 (*.sc)</translation>
              </message>
              <message>
                  <source>Serial</source>
                  <translation>串口</translation>
              </message>
              <message>
                  <source>Telnet</source>
                  <translation>Telnet</translation>
              </message>
              <message>
                  <source>Address:</source>
                  <translation>地址：</translation>
              </message>
              <message>
                  <source>Arc approximation
          segment size:</source>
                  <translation>圆弧近似
          段大小：</translation>
              </message>
              <message>
                  <source>By length</source>
                  <translation>按长度</translation>
              </message>
              <message>
                  <source>By angle (deg.)</source>
                  <translation>按角度（度）</translation>
              </message>
              <message>
                  <source>WebSocket</source>
                  <translation>WebSocket</translation>
              </message>
              <message>
                  <source>URL:</source>
                  <translation>URL：</translation>
              </message>
              <message>
                  <source>Mode:</source>
                  <translation>模式：</translation>
              </message>
              <message>
                  <source>Binary</source>
                  <translation>二进制</translation>
              </message>
              <message>
                  <source>0.1, 1, 10, ...</source>
                  <translation>0.1, 1, 10, ...</translation>
              </message>
              <message>
                  <source>Jog steps:</source>
                  <translation>点动步长：</translation>
              </message>
              <message>
                  <source>1, 10, 100, ...</source>
                  <translation>1, 10, 100, ...</translation>
              </message>
              <message>
                  <source>Jog feeds:</source>
                  <translation>点动进给：</translation>
              </message>
              <message>
                  <source>Machine information</source>
                  <translation>机器信息</translation>
              </message>
              <message>
                  <source>Reset machine on connection</source>
                  <translation>连接时重置机器</translation>
              </message>
          </context>
          </TS>
          '@

          Set-Content -Path $tsFile -Value $content -Encoding UTF8
          Write-Host "Created $tsFile with Chinese translations."


      # 缓存 vcpkg
      - name: Download vcpkg cache
        uses: actions/cache@v4
        id: cache-vcpkg
        with:
          path: vcpkg_cache
          key: vcpkg-${{ runner.os }}-${{ hashFiles('vcpkg.json') }}

      - name: Ensure vcpkg cache dir
        if: steps.cache-vcpkg.outputs.cache-hit != 'true'
        run: mkdir vcpkg_cache

      # Bootstrap vcpkg
      - name: Bootstrap vcpkg
        run: |
          git clone --branch 2025.07.25 --depth 1 https://github.com/microsoft/vcpkg.git
          ./vcpkg/bootstrap-vcpkg.bat

      # 配置 CMake
      - name: Configure CMake
        run: |
          cmake -B ${{ github.workspace }}/build -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }} -DCMAKE_TOOLCHAIN_FILE=${{ github.workspace }}/vcpkg/scripts/buildsystems/vcpkg.cmake -DCMAKE_INSTALL_PREFIX=${{ github.workspace }}/build/Candle

      # 构建
      - name: Build
        run: cmake --build ${{ github.workspace }}/build --config ${{ env.BUILD_TYPE }} --parallel 4

      # 安装（用于 portable 包）
      - name: Install
        run: cmake --install ${{ github.workspace }}/build --config ${{ env.BUILD_TYPE }}

      # 获取版本号
      - name: Get latest tag
        id: tag
        run: |
          $tag = git describe --tags --abbrev=0
          $version = $tag -replace '^v', ''
          echo "version=$version" >> $env:GITHUB_OUTPUT

      # 准备 portable 版本
      - name: Prepare portable version
        shell: pwsh
        run: |
          $portableDir = "${{ github.workspace }}/artifact/candle-${{ steps.tag.outputs.version }}-portable"
          New-Item -ItemType Directory -Path $portableDir -Force
          Copy-Item -Recurse -Path "${{ github.workspace }}/build/Candle/*" -Destination $portableDir

      # 上传 Artifact
      - name: Upload portable version
        uses: actions/upload-artifact@v4
        with:
          name: candle-${{ steps.tag.outputs.version }}-portable
          path: ${{ github.workspace }}/artifact/
